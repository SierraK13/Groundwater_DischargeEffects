# Results  

```{r, include=FALSE}

library(dataRetrieval)
library(tidyverse)
library(trend)
library(lubridate)
knitr::opts_chunk$set(echo = TRUE)

```


## Data Acquisition 

```{r}
##Surface water discharge data

site_ca <- "10265150" # USGS site number for Hot C A Flume near Mammoth Lakes
q_ca <- readNWISdv(siteNumbers = site_ca, 
                parameterCd = '00060', 
                startDate = '1983-07-07', 
                endDate = '2021-12-18') %>% 
  rename(q_cfs = X_00060_00003)
```


```{r, eval=FALSE}
##Ground water data---Still need to figure out how to collect data

site_ca_gw <- "373845118574202" # USGS site number for GW gage near Mammoth Lakes
depth_1 <- readNWISuv(siteNumbers = site_ca_gw,
                       parameterCd = '72019',
                startDate = '2021-01-07', 
                endDate = '2021-12-18') %>%
  rename(waterdepth = X_72019_00000)
```


```{r}

site_ca <- "10265150" 
q_ca <- readNWISdv(siteNumbers = site_ca, 
                parameterCd = '00060', 
                startDate = '1983-07-07', 
                endDate = '2021-12-18') %>% 
  rename(q_cfs = X_00060_00003) %>%
  addWaterYear(.) %>%
  select(-agency_cd, -X_00060_00003_cd)


```

## Attribute Analysis

Water Table 

```{r, eval=FALSE}
ggplot(depth_1, aes(x = Date, y = waterdepth)) + 
  geom_line() + 
  ylab('Q (cfs)')
```

Surface Water Discharge

```{r}
ggplot(q_ca, aes(x = Date, y = q_cfs)) + 
  geom_line() + 
  ylab('Q (cfs)')
```

Monthly Water Trends

```{r}

q_month_means <- q_ca %>%
  dplyr::mutate(month = month(Date),
                year = year(Date)) %>%
  group_by(year, month) %>%
  summarize(q_mean = mean(q_cfs, na.rm = T))

head(q_month_means) 

```

Discharge Trends in September

```{r}

q_sept <- q_month_means %>%
  filter(month ==9)

ggplot(q_sept, aes( x= year, y= q_mean)) +
  geom_point() + 
  scale_y_log10() +
  ylab('Q (cfs)') +
  xlab('Water Year') 

```

Discharge Trends in March

```{r}

q_march <- q_month_means %>%
  filter(month == 3)

ggplot(q_march, aes( x= year, y= q_mean)) +
  geom_point() + 
  scale_y_log10() +
  ylab('Q (cfs)') +
  xlab('Water Year') 
```

## Statistical Trend Analysis

Mann-Kendall Test
```{r}

mk.test(log10(q_sept$q_mean))

sens.slope(q_sept$q_mean)

```


## Annual Discharge minimum, median, mean  

```{r}
q_stats <- q_ca %>%
  dplyr::mutate(month = month(Date),
                year = year(Date)) %>%
  group_by(year, month) %>%
  summarize(q_mean = mean(q_cfs, na.rm = T),
            q_min = min(q_cfs),
            q_med = median(q_cfs))

head(q_stats)

```


```{r} 
# mean

ggplot(q_month_means, aes(x= year, y= q_mean)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') + 
  scale_y_log10() +
  ylab('Mean Monthly Discharge') + 
  xlab('Year')

```

```{r}
# minimum

ggplot(q_stats, aes(x= year, y= q_min)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()+
  ylab('Monthly Minimum Discharge') + 
  xlab('Year')

```

```{r}
# median

ggplot(q_stats, aes(x= year, y= q_med)) +
  geom_point() +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10()+
  ylab('Median Monthly Discharge') + 
  xlab('Year')

```



##Practice

Plot to compare median and minimum 

Not sure how to make a nice legend 
Easier coding to have multiple variables on a graph?

```{r}

ggplot(q_stats, aes(x= year)) +
  geom_point(aes(y=q_mean), color = "purple") +
  geom_point(aes(y=q_min), color = "light blue") +
  geom_point(aes(y=q_med), color = " dark green") +
  facet_wrap(~month, scales = 'free') +
  scale_y_log10() +
  ylab("Monthly Statistics") 

```

Monthly stat comparison of June

```{r}
q_june <- q_stats %>%
  filter(month == 6)

ggplot(q_june, aes(x= year)) +
  geom_point(aes(y=q_mean), color = "purple") +
  geom_point(aes(y=q_min), color = "light blue") +
  geom_point(aes(y=q_med), color = " dark green") +
  scale_y_log10() +
  ylab("Monthly Statistics") +
  xlab("Year")
```

