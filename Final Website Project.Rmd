---
title: "Final Final"
author: "Sierra Klemme"
site: bookdown::bookdown_site
documentclass: book
bibliography: bib440.bib 
output:
  bookdown::gitbook: default
  #bookdown::pdf_book: default
--- 

# Introduction 

  Within recent decades groundwater research has increased in significance due to 
its influential interactions with surface water. The 
understanding of the exchanges between groundwater and surface water 
has also gained popularity due to the effects on the global fresh water supply.
Groundwater and surface water (GW, SW) are not independent sources 
but rather influential systems 
that effects several hydrologic characteristics such as baseflow and 
recharge. As any other process, the hydrologic cycle is 
effected by outside factors. The term "hydrogeologic environment" 
coined by hydrogeologist J.TÃ³th denotes the need to acknowledge the 
effects of topography, geology, and climate to further understand
GW and SW interaction [@sophocleous_interactions_2002]. 
Previous research has often defined base flows of surface water 
systems to be sourced by upstream ground water storage's 
[@brutsaert_long-term_2008]. With this reference, benefits from
looking at global changes in temperature and precipitation include 
ways to predict ground water levels impacts on surface water 
discharge and how the overall water budget is being effected by global 
climate change [@huntington_role_2012].

  As anthropogenic effects become more notable in nature it raises a need 
to understand GW and SW exchanges in order to protect one of our most valuable
resources. With activities such as mining and contaminated runoff it is valuable 
to quantify flows between GW and SW to help mitigate damage to the riparian area
and decrease harm to organisms who may ingest contaminated water 
[@kalbus_measuring_2006]. Further studies of the lag 



## Research Question

How is climate change affecting ground water levels that can influence base flows 
in surface water discharge along Hot Creek near Mammoth Lakes, California? Specifically,
the attributes in consideration are temperature, precipitation, ground water 
depth, and surface water discharge raters. 



<!--chapter:end:index.Rmd-->

---
title: "methods"
author: "Sierra Klemme"
date: "3/9/2022"
output: html_document
---

```{r setup, include = F}
library(tidyverse)
library(sf)
library(dataRetrieval)
library(nhdplusTools)
library(mapview)
library(devtools)
```

# Methods 

## Site Description 

  For this report, a more in depth analysis of how climate change 
impacts the interactions between ground water
and surface water will be reviewed  
at stations near Mammoth Lakes California along Hot Creek. This
site allows for water movement to be monitored due to the assumptions
that groundwater due to various factors will later re-emerge into terrestrial
water downstream of the groundwater source or aquifer [@kalbus_measuring_2006].
Mammoth Lakes has a coincidental set up to show the process of water transfer between
GW and SW due to a grouping of ground water monitors 
upstream of a surface water monitor along Hot Creek. Mammoth
Lakes is at 7,880 feet in elevation with soils of low infiltration
and located in a pre-dominantly Mediterranean climate [web soil & plantmaps]. 
This particular site where factors such as climate, temperature, groundwater
levels, and discharge can be monitored will allow this analysis to compare 
climate changes to groundwater and surface water quantities. 

***also put in what methods used to find results 

## Watershed Delineation

```{r}

mapviewOptions(fgb = FALSE)

site_coords_CA1 <- readNWISsite("10265150") %>%
  st_as_sf(coords = c('dec_long_va', 'dec_lat_va'), remove= FALSE, crs = 4326) %>%
  st_transform(crs = 4269)


CAwatershed <- st_read('MammothCA.geojson') %>% dplyr::filter(id== 'globalwatershed') 

mapview(CAwatershed) + mapview(site_coords_CA1)
```


<!--chapter:end:1_methods.Rmd-->

# Results  

```{r, include=FALSE}

library(dataRetrieval)
library(tidyverse)
library(trend)
library(lubridate)
knitr::opts_chunk$set(echo = TRUE)

```

## Data Acquisition 

```{r}
##Surface water discharge data

site_ca <- "10265150" 
q_ca <- readNWISdv(siteNumbers = site_ca, 
                parameterCd = '00060', 
                startDate = '1992-01-19', 
                endDate = '2022-04-06') %>% 
  rename(q_cfs = X_00060_00003) %>%
  addWaterYear(.) %>%
  select(-agency_cd, -X_00060_00003_cd) %>%
  mutate(Site = "Hot CA Flume SW") %>%
  select(-site_no)

```


```{r}
##Ground water data

gw_depth <- read_csv('gw_data.csv')

gw_depth <- gw_depth %>%
  mutate(Site = "Hot Creek GW") %>%
  select(-site)

```

```{r}
##Climate Data

mam_climate <- read_csv('Date_Mammoth_climate.csv')

```

## Attributes

Groundwater Depth 

```{r}
ggplot(gw_depth, aes(x = Date, y = water_depth)) + 
  geom_line(color = 'gray') + 
  ylab('Ground Water Depth (feet)') +
  theme_bw()
```

Surface Water Discharge

```{r}
ggplot(q_ca, aes(x = Date, y = q_cfs)) + 
  geom_line(color = 'lightblue') + 
  ylab('Q (cfs)') +
  theme_bw()
```


## Attribute Analysis 

GW and SW Long

```{r}

sw_gw <- left_join(gw_depth, q_ca, by = "Date")

sw_gw_graph <- ggplot() +
    geom_line(data = sw_gw, aes(x=Date, y=water_depth*3), color = 'grey') +  
    geom_line(data = sw_gw, aes(x=Date, y=q_cfs), color = 'lightblue') 

   
sw_gw_graph + scale_y_continuous(sec.axis = sec_axis(~./3)) + 
  theme_bw() + 
  ylab("Discharge (cfs)") +
  xlab("Date")
```

Temperature and Precipitation 

```{r}

t_annual <- mam_climate %>%
  dplyr::mutate(month = month(Date),
                year = year(Date)) %>%
  group_by(year) %>%
  summarize(Avrg_T = mean(Avrg_T, na.rm = T)) 

p_annual <- mam_climate %>%
  dplyr::mutate(month = month(Date),
                year = year(Date)) %>%
  group_by(year) %>%
  summarize(Precip = mean(Precip, na.rm = T))

t_p_annual <- cbind(t_annual, p_annual) %>%
  select(-3)

t_p <- ggplot() +
  geom_line(data = t_p_annual, aes(x=year, y= Avrg_T), color = 'orange') +
  geom_line(data = t_p_annual, aes(x=year, y=Precip*10), color = 'brown') +
  xlab("Water Year") +
  scale_color_brewer(guide = "legend")

t_p + scale_y_continuous(name = "Temp (F)" , sec.axis = sec_axis(trans=~./10 , name= "Precip (mm)"))
                                             breaks = c(0,1,2,3,4,5) + 
                                            breaks = c(0,20,40,50) +
  theme_bw()+ 
  ggtitle("Average Annual Temp and Precip")

```

GW, Temp, Precip

```{r}
gw_annual <- gw_depth %>%
  dplyr::mutate(month = month(Date),
                year = year(Date)) %>%
  group_by(year) %>%
  summarize(water_depth = mean(water_depth, na.rm = T)) 

gw_tp_annual <- left_join(gw_annual, t_p_annual)

layout(matrix(c(1,2), 1, 2, byrow = TRUE)) +
plot(gw_tp_annual$water_depth, gw_tp_annual$Avrg_T, col="gray", pch = 16, main="Temperature", ylab = "Average Temperature (F)", xlab = "Water Depth (ft)") +
plot(gw_tp_annual$water_depth, gw_tp_annual$Precip, col="brown", pch = 16, main="Precipitation", xlab = "Water Depth (ft)", ylab = "Precipitation (mm)") 
  
```

Monthly Water Trends

```{r}

q_month_means <- q_ca %>%
  dplyr::mutate(month = month(Date),
                year = year(Date)) %>%
  group_by(year, month) %>%
  summarize(q_mean = mean(q_cfs, na.rm = T))

```


Discharge Trends for baseflow months

```{r}

q_base <- q_month_means %>% 
  filter(month %in% c('7','8','9','10'))

ggplot(q_base, aes( x= year, y= q_mean)) +
  geom_point(aes(color = factor(month))) + 
  scale_y_log10() +
  ylab('Q (cfs)') +
  xlab('Water Year')+
  scale_color_discrete()

```

## Statistical Trend Analysis

```{r}
#Surface Water Discharge 

mk.test(log10(q_month_means$q_mean))

sens.slope(q_month_means$q_mean)
```


```{r}
#Baseflow month trends

mk.test(log10(q_base$q_mean))

sens.slope(q_base$q_mean)
```

```{r}
#Ground Water Level

mk.test(log10(gw_depth$water_depth))

sens.slope(gw_depth$water_depth)
```

```{r}
#Temperature

t_test <- gw_tp_annual %>%
  select(-Precip)

test <- t_test %>%
  filter(year <2018)

mk.test(log10(test$Avrg_T))

sens.slope(test$Avrg_T)

**not signigicant change of increasing temp by 0.05 degrees each year

```




<!--chapter:end:2_results.Rmd-->



`r if (knitr:: is_html_output()) '# Refrences {-}'`


<!--chapter:end:wrapping_up.Rmd-->

